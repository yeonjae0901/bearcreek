# 베어크리크 골프장 예약 알리미

베어크리크 춘천 골프장의 예약 가능한 날짜를 자동으로 확인하고 텔레그램으로 알려주는 프로그램입니다.

## 프로젝트 소개

이 프로젝트는 베어크리크 골프장의 예약 시스템을 자동으로 모니터링하여 새로운 예약 가능 날짜가 있을 때 텔레그램으로 즉시 알림을 보내는 자동화 도구입니다. 특히 인기 있는 예약 날짜를 놓치지 않도록 도와줍니다.

## 개발 현황 및 제한사항

**[2025년 4월 25일 업데이트]**

현재 베어크리크 골프장은 자동화된 접근을 강력하게 차단하고 있어 웹 스크레이핑이 불가능한 상태입니다. 다음과 같은 방법을 시도했으나 모두 우회할 수 없었습니다:

1. **Chrome/Firefox 웹드라이버 접근**: 406 Not Acceptable 오류 발생 (Selenium)
2. **Cloudscraper 우회 라이브러리**: 접근 차단 (406 오류 지속)
3. **Playwright + 스텔스 모드**: 브라우저 자동화 감지 회피 시도 실패
4. **실제 쿠키 활용 방식**: 쿠키를 생성해도 API 호출 차단
5. **다양한 헤더 설정 및 브라우저 지문 모방**: 차단 지속

현재로서는 웹사이트가 Cloudflare의 고급 봇 방지 시스템을 사용하여 자동화된 접근을 완전히 차단하고 있어, 프로그램 실행이 중단된 상태입니다. 수동 확인 외에 자동화된 방법으로 예약 가능 날짜를 확인하는 것은 불가능합니다.

### 작동 방식

1. Selenium 웹드라이버를 사용하여 베어크리크 골프장 예약 페이지에 접속합니다.
2. 설정한 월(기본값: 5월)의 예약 가능한 날짜를 자동으로 스캔합니다.
3. 예약 가능한 날짜가 발견되면 텔레그램 봇을 통해 알림 메시지를 보냅니다.
4. 설정된 시간 간격으로 위 과정을 반복합니다.

## 기능

- 설정한 월(기본값: 5월)의 예약 가능한 날짜를 자동으로 확인
- 예약 가능한 날짜가 있으면 텔레그램으로 알림
- 각 날짜의 예약 가능한 시간과 코스 정보 표시 (시간, 코스명, 가격 포함)
- 정기적인 스케줄링을 통해 자동으로 반복 확인 (기본값: 10분 간격)
- 디버깅을 위한 스크린샷 및 로그 기능
- 자동 디스크 공간 관리 및 시스템 정리 기능

## 대체 솔루션

보안 차단으로 인해 직접적인 웹 스크레이핑이 불가능한 상황에서, 다음과 같은 대체 솔루션을 고려해볼 수 있습니다:

1. **수동 예약 알림 시스템**: 정해진 시간에 텔레그램으로 예약 체크 알림을 보내고, 사용자가 직접 웹사이트에 접속하여 확인하는 방식
2. **예약 대행 서비스 활용**: 인력을 통한 예약 대행 서비스 사용
3. **캡차 해결 서비스 연동**: 상업적 캡차 해결 서비스와 통합 (법적 검토 필요)

## 설치 방법

1. 이 저장소를 클론합니다:
   ```bash
   git clone https://github.com/yeonjae0901/bearcreek.git
   cd bearcreek
   ```

2. Python 3.8 이상이 필요합니다.

3. 필요한 패키지 설치:
   ```bash
   pip install -r requirements.txt
   ```

4. Chrome 브라우저가 설치되어 있어야 합니다.

5. 환경 변수 설정:
   `.env.example` 파일을 `.env`로 복사하고 필요한 정보를 입력합니다.
   ```bash
   cp .env.example .env
   ```

## 환경 변수 설정

`.env` 파일에 다음 정보를 설정해야 합니다:

- `TELEGRAM_BOT_TOKEN`: 텔레그램 봇 토큰
- `TELEGRAM_CHAT_ID`: 텔레그램 채팅 ID
- `MONTH`: 확인할 월 (기본값: 5)
- `YEAR`: 확인할 연도 (기본값: 2025)
- `CHECK_INTERVAL_MINUTES`: 확인 주기 (분 단위, 기본값: 5)

### 텔레그램 봇 설정 방법

1. 텔레그램에서 BotFather(@BotFather)를 검색합니다.
2. `/newbot` 명령을 실행하고 지시에 따라 봇 이름과 사용자 이름을 설정합니다.
3. 생성이 완료되면 봇 토큰을 받게 됩니다. 이 토큰을 `.env` 파일의 `TELEGRAM_BOT_TOKEN`에 입력합니다.
4. 생성한 봇에게 메시지를 보낸 후, 브라우저에서 `https://api.telegram.org/bot<봇_토큰>/getUpdates`에 접속합니다.
5. 응답에서 `chat_id` 값을 확인하고 `.env` 파일의 `TELEGRAM_CHAT_ID`에 입력합니다.

## 실행 방법

```bash
python bearcreek_checker.py
```

### 단일 실행 모드

한 번만 실행하고 종료하려면:

```bash
python bearcreek_checker.py --single
```

### 백그라운드 실행 (리눅스/MacOS)

서버에서 백그라운드로 실행:

```bash
nohup python bearcreek_checker.py > bearcreek.log 2>&1 &
```

## EC2 서버 설정

AWS EC2와 같은 클라우드 서버에서 실행하려면:

1. Chromium 설치:
   ```bash
   sudo apt-get update
   sudo apt-get install -y chromium-browser
   ```

2. 필요한 Python 패키지 설치:
   ```bash
   pip install -r requirements.txt
   ```

3. 백그라운드에서 실행:
   ```bash
   nohup python bearcreek_checker.py > bearcreek.log 2>&1 &
   ```

## 시스템 정리 및 디스크 관리

### 자동 정리 기능 (simple_cleaner.py)

이 프로그램은 자동으로 디스크 공간을 관리하는 기능이 포함되어 있습니다:

- 오래된 로그 및 이미지 파일 정리
- Chrome 브라우저 임시 파일 정리
- 디스크 사용량 모니터링

simple_cleaner.py는 다음 명령으로 실행됩니다:

```bash
python simple_cleaner.py
```

### Snap 패키지 정리

디스크 사용량이 80%를 초과하면 자동으로 `snap_cleanup.sh` 스크립트가 생성됩니다. 이 스크립트는 다음 작업을 수행합니다:

- 스냅 패키지 최대 버전 수 제한 (2개)
- 스냅 캐시 정리
- 오래된 로그 파일 정리

스크립트를 실행하려면:

```bash
sudo ./snap_cleanup.sh
```

> **참고**: 이 명령은 관리자 권한(sudo)이 필요합니다.

디스크 공간이 부족하거나 시스템이 느려지는 경우, 이 스크립트를 실행하여 공간을 확보할 수 있습니다.

## 주의사항

- 이 프로그램은 베어크리크 골프장의 웹사이트 구조 변경에 따라 작동하지 않을 수 있습니다.
- 웹사이트의 과도한 접속은 차단될 수 있으니 CHECK_INTERVAL_MINUTES 값을 적절히 설정하세요.
- 개인적인 용도로만 사용하세요.

## 라이선스

이 프로젝트는 MIT 라이선스를 따릅니다.
